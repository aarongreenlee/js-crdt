!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).crdt=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function merge(a,b){return a.merge(b)}function equal(a,b){return a.equal(b)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.merge=merge,exports.equal=equal,exports.compare=function(a,b){return a.compare(b)},exports.concat=function(a,b){return a.concat(b)},exports.applyOperation=function(operation,data){return operation.apply(data)},exports.axioms=function(assert,a,b,c){a.merge(b);assert(equal(merge(a,b),merge(b,a)),"is not commutative"),assert(equal(merge(a,merge(b,c)),merge(merge(a,b),c)),"is not associative"),assert(equal(merge(a,a),a),"is not idempotent")}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Increment{constructor(value){this.value=value}merge(b){return new Increment(Math.max(this.value,b.value))}equal(b){return this.value===b.value}increment(){return new Increment(this.value+1)}}exports.Increment=Increment},{}],3:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),__export(require("./functions")),__export(require("./increment")),__export(require("./utils")),__export(require("./order/index")),__export(require("./text/index"))},{"./functions":1,"./increment":2,"./order/index":5,"./text/index":11,"./utils":14}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const utils_1=require("../utils");class Discrete{constructor(id,vector){(vector=utils_1.clone(vector))[id]=vector[id]||0,this.id=id,this.vector=vector}next(){const vector=utils_1.clone(this.vector);return++vector[this.id],new Discrete(this.id,vector)}merge(b){const vector=utils_1.union(Object.keys(this.vector),Object.keys(b.vector)).reduce((vector,key)=>(vector[key]=Math.max(this.vector[key]||0,b.vector[key]||0),vector),{});return new Discrete(this.id,vector)}equal(b){return 0===this.compare(b)}compare(b){const position=utils_1.common(this.vector,b.vector).reduce((result,key)=>result+(this.vector[key]-b.vector[key]),0);if(0!==position)return position;const dif=utils_1.diff(this.vector,b.vector).length-utils_1.diff(b.vector,this.vector).length;if(0!==dif)return dif;const tipPosition=this.vector[this.id]-b.vector[b.id];if(0!==tipPosition)return tipPosition;const ha=b.vector.hasOwnProperty(this.id),hb=this.vector.hasOwnProperty(b.id);return ha||hb?ha&&!hb?-1:hb&&!ha?1:0:this.id<b.id?-1:1}}exports.Discrete=Discrete},{"../utils":14}],5:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),__export(require("./discrete")),__export(require("./timestamp")),__export(require("./discrete")),__export(require("./timestamp"))},{"./discrete":4,"./timestamp":6}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Timestamp{constructor(bucket,time){this.bucket=bucket,this.time=time}next(){return new Timestamp(this.bucket,this.time+1)}compare(b){return this.bucket===b.bucket?this.time-b.time:this.bucket<b.bucket?-1:1}merge(b){return this}equal(b){return!1}}exports.Timestamp=Timestamp},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class NaiveArrayList{constructor(array){this.array=array||[]}insert(at,item){const clone=this.array.slice(0);return clone.splice(at,0,item),new NaiveArrayList(clone)}get(at){return this.array[at]}size(){return this.array.length}reduce(fn,aggregator){return this.array.reduce(fn,aggregator)}}exports.NaiveArrayList=NaiveArrayList},{}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Indexed{constructor(value,index){this.value=value,this.index=index}compare(b){return this.value.compare(b.value)}}exports.Indexed=Indexed;class SetMap{constructor(keys,values){this.keys=keys,this.values=values}set(key,value){const result=this.keys.add(new Indexed(key,this.keys.size()));return new SetMap(result.result,this.values.set(result.value.index,value))}get(key){const result=this.keys.add(new Indexed(key,this.keys.size()));return result.result===this.keys?null:this.values.get(result.value.index)}merge(b){return b.reduce((aggregator,item,key)=>aggregator.set(key,item),this)}reduce(fn,aggregator){return this.keys.reduce((aggregator,key)=>fn(aggregator,this.values.get(key.index),key.value),aggregator)}}exports.SetMap=SetMap},{}],9:[function(require,module,exports){"use strict";function divide(lower,upper,elements,item,onNew,onExists){const step=upper-lower;if(step<1)return onNew(item,elements,lower);const idx=lower+step,elm=elements.get(idx),cmp=elm.compare(item);return cmp<0?divide(idx,upper,elements,item,onNew,onExists):cmp>0?divide(lower,idx,elements,item,onNew,onExists):onExists(elm,elements)}Object.defineProperty(exports,"__esModule",{value:!0});class Tuple{constructor(result,value){this.result=result,this.value=value}}class SortedSetArray{constructor(elements){this.elements=elements}size(){return this.elements.size()}add(value){return divide(0,this.elements.size()-1,this.elements,value,(value,elements,lower)=>new Tuple(new SortedSetArray(elements.insert(lower,value)),value),(value,elements)=>new Tuple(this,value))}has(value){return divide(0,this.elements.size()-1,this.elements,value,()=>!1,()=>!0)}union(b){return b.reduce((result,item)=>result.add(item).result,this)}reduce(fn,accumulator){return this.elements.reduce(fn,accumulator)}}exports.SortedSetArray=SortedSetArray},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const utils_1=require("../utils");class Delete{constructor(at,length){this.at=at,this.length=length}apply(data){if(this.at<0)return data;let copy=data.slice(0);return(copy=utils_1.ensureArrayLength(copy,this.at)).splice(this.at,this.length),copy}}exports.Delete=Delete},{"../utils":14}],11:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),__export(require("./insert")),__export(require("./delete")),__export(require("./text"))},{"./delete":10,"./insert":12,"./text":13}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const utils_1=require("../utils");class Insert{constructor(at,value){this.at=at<0?0:at,this.value=String(value)}apply(data){let copy=data.slice(0);return(copy=utils_1.ensureArrayLength(copy,this.at)).splice(this.at,0,...this.value.split("")),copy}}exports.Insert=Insert},{"../utils":14}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const functions_1=require("../functions"),set_map_1=require("../structures/set-map"),sorted_set_array_1=require("../structures/sorted-set-array"),naive_array_list_1=require("../structures/naive-array-list");class Text{constructor(order,setMap){this.order=order,this.setMap=setMap,this.setMap=setMap||new set_map_1.SetMap(new sorted_set_array_1.SortedSetArray(new naive_array_list_1.NaiveArrayList([])),new Map)}next(){return new Text(this.order.next(),this.setMap)}apply(operation){let value=this.setMap.get(this.order);value||(value=[]),value.push(operation),this.setMap=this.setMap.set(this.order,value)}merge(b){return new Text(functions_1.merge(this.order,b.order).next(),this.setMap.merge(b.setMap))}equal(b){return functions_1.equal(this.order,b.order)}reduce(fn,accumulator){return this.setMap.reduce((accumulator,operations,order)=>operations.reduce((accumulator,operation)=>fn(accumulator,operation,order),accumulator),accumulator)}forEach(fn){return this.setMap.reduce((_,operations,order)=>(fn({order:order,operations:operations}),_),null)}}exports.Text=Text},{"../functions":1,"../structures/naive-array-list":7,"../structures/set-map":8,"../structures/sorted-set-array":9}],14:[function(require,module,exports){"use strict";function keyToMap(r,i){return r[i]=!0,r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.between=function(value,min,max){return!(value<=min||value>=max)},exports.ensureArrayLength=function(array,len){return array.length<len&&(array.length=len),array},exports.sortNumbers=function(a,b){return a-b},exports.clone=function(obj){var target={};for(const i in obj)obj.hasOwnProperty(i)&&(target[i]=obj[i]);return target},exports.union=function(a,b){return a=a.reduce(keyToMap,{}),b=b.reduce(keyToMap,a),Object.keys(b)},exports.common=function(a,b){return Object.keys(a).reduce((r,k)=>(b.hasOwnProperty(k)&&r.push(k),r),[]).sort()},exports.diff=function(a,b){return Object.keys(a).reduce((r,k)=>(b.hasOwnProperty(k)||r.push(k),r),[])}},{}]},{},[3])(3)});